<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

    <link href="timemachine-viewer/css/snaplapse.css" rel="stylesheet" type="text/css"/>
    <link href="timemachine-viewer/css/jquery-ui/smoothness/jquery-ui.custom.css" rel="stylesheet" type="text/css"/>
    <link href="timemachine-viewer/css/defaultUI.css" rel="stylesheet" type="text/css"/>
    <link href="timemachine-viewer/css/visualizer.css" rel="stylesheet" type="text/css"/>
    <link href="timemachine-viewer/css/annotator.css" rel="stylesheet" type="text/css"/>

    <script src="timemachine-viewer/js/jquery/jquery.min.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/jquery/jquery-ui.custom.min.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/jquery/plugins/mouse/jquery.mousewheel.min.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/kinetic/kinetic.min.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/util.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/timelapse/videoset.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/timelapse/parabolicMotion.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/timelapse/timelapse.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/Math.uuid.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/timelapse/snaplapse.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/timelapse/snaplapseViewer.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/timelapse/mercator.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/timelapse/visualizer.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/timelapse/annotator.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/timelapse/defaultUI.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/timelapse/urlEncoder.js" type="text/javascript"></script>

    <script src="timemachine-viewer/js/org/gigapan/postmessage.js" type="text/javascript"></script>
    <script src="timemachine-viewer/js/org/gigapan/timelapse/crossdomain_api.js" type="text/javascript"></script>

    <script src="timemachine-viewer/template_includes.js" type="text/javascript"></script>

    <link href="css/grapher.css" rel="stylesheet" type="text/css"/>
    <script src="js/grapher/grapher2.nocache.js"></script>
    <script src="js/grapher.js"></script>

    <style>
      #timeMachine {
        position: absolute;
        top: 10px;
        left: 10px;
        width: 980px;
        height: 492px;
      }
      #datepicker {
        position: absolute;
        top: 10px;
        left: 1000px;
        font-size: 10px;
      }
      #datepicker .ui-state-default {
        background: white;
      }
      #datepicker .date-highlight a {
        background: rgb(240, 240, 240);
      }
      #datepicker .ui-state-active {
        border: 1px solid #000000;
      }
      .ui-datepicker-today a.ui-state-highlight {
        border-color: #d3d3d3;
        color: #555555;
      }
    </style>

    <script type="text/javascript">
      jQuery.support.cors = true;

      var json_breathecam;

      function highlightDays(date) {
        date = $.datepicker.formatDate('yy-mm-dd', date);
        if (json_breathecam.datasets[date])
          return [true, 'date-highlight'];
        else
          return [false, ''];
      }

      function selectDay(dateText, dateElem) {
        var date = $.datepicker.formatDate('yy-mm-dd', new Date(dateText));
        var path = json_breathecam.datasets[date];
        if ( typeof (timelapse) !== "undefined" && timelapse && path)
          timelapse.loadTimelapse(path, null, null, true);
      }

      function createDatepicker() {
        var startingDate = json_breathecam.latest.date;
        var dateArray = startingDate.split("-");
        $("#datepicker").datepicker({
          defaultDate: new Date(dateArray[0], dateArray[1] - 1, dateArray[2]),
          minDate: new Date(2014, 0),
          onSelect: selectDay,
          beforeShowDay: highlightDays
        });
      }

      function createTimeMachine() {
        var settings = {
          url: json_breathecam.latest.path,
          showFullScreenBtn: false,
          mediaType: ".mp4",
          onTimeMachinePlayerReady: function(viewerDivId) {
            setupPostMessageHandlers();
          },
          disableTourLooping: true,
          showLogoOnDefaultUI: false,
          datasetType: "breathecam"
        };
        timelapse = new org.gigapan.timelapse.Timelapse("timeMachine", settings);
      }

      function init() {
        $.ajax({
          type: "GET",
          url: 'http://timemachine1.gc.cs.cmu.edu/timemachines/breathecam/timemachines/heinz/heinz.json',
          crossDomain: true,
          success: function(json) {
            console.log("Breathecam connecting succeed.");
            json_breathecam = json
            createTimeMachine();
            createDatepicker();
          },
          error: function() {
            console.log("Breathecam connecting failed.");
          }
        });
      }

      $(init);
    </script>
  </head>
  <body>
    <div id="timeMachine"></div>
    <div id="datepicker"></div>
    <div id="grapher"></div>
  </body>
</html>